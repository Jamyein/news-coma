# ==========================================
# RSS 新闻聚合配置
# 支持14家国内外LLM提供商
# ==========================================

# ==========================================
# 数据源配置
# ==========================================
rss_sources:
  - name: "TechCrunch"
    url: "https://techcrunch.com/feed/"
    weight: 1.0
    category: "科技"
    enabled: true
  
  - name: "GitHub Blog"
    url: "https://github.blog/feed/"
    weight: 1.0
    category: "开发"
    enabled: true
  
  - name: "Hacker News"
    url: "https://news.ycombinator.com/rss"
    weight: 1.5
    category: "技术"
    enabled: true
  
  - name: "The Verge"
    url: "https://www.theverge.com/rss/index.xml"
    weight: 0.9
    category: "科技"
    enabled: true
  
  - name: "The Economist"
    url: "https://www.economist.com/finance-and-economics/rss.xml"
    weight: 1.2
    category: "国际财经"
    enabled: true
  
  - name: "CNBC"
    url: "https://www.cnbc.com/id/10000664/device/rss/rss.html"
    weight: 1.4
    category: "国际财经"
    enabled: true
  
  - name: "BBC Business"
    url: "https://feeds.bbci.co.uk/news/business/rss.xml"
    weight: 1.3
    category: "国际财经"
    enabled: true
  
  - name: "MarketWatch"
    url: "https://www.marketwatch.com/rss/topstories"
    weight: 1.0
    category: "国际财经"
    enabled: true
  
  - name: "Financial Times"
    url: "https://www.ft.com/rss/home/international"
    weight: 1.2
    category: "国际财经"
    enabled: true
  
  - name: "华尔街见闻"
    url: "https://dedicated.wallstreetcn.com/rss.xml"
    weight: 1.6
    category: "国内财经"
    enabled: true
  
  - name: "36氪"
    url: "https://36kr.com/feed"
    weight: 1.6
    category: "国内财经"
    enabled: true
  
  - name: "东方财富"
    url: "http://rss.eastmoney.com/rss_partener.xml"
    weight: 1.6
    category: "国内财经"
    enabled: true
  
  - name: "WSJ 经济"
    url: "https://feeds.content.dowjones.io/public/rss/WSJcomUSBusiness"
    weight: 1.4
    category: "国际财经"
    enabled: true
  
  - name: "WSJ 市场"
    url: "https://feeds.content.dowjones.io/public/rss/RSSMarketsMain"
    weight: 1.3
    category: "国际财经"
    enabled: true
  
  - name: "WSJ 全球经济"
    url: "https://feeds.content.dowjones.io/public/rss/socialeconomyfeed"
    weight: 1.2
    category: "国际财经"
    enabled: true

# ==========================================
# AI 提供商配置（简化版）
# 只需修改 ai_provider 字段即可切换
# ==========================================


ai:
# 当前使用的提供商
# 可选值: gemini, openai, azure, claude, deepseek, zhipu, kimi, qwen, wenxin, spark, yi, minimax, ollama
  ai_provider: "zhipu"

  ai_providers:
  
    gemini:
      api_key: "${GEMINI_API_KEY}"
      base_url: "https://generativelanguage.googleapis.com/v1beta/openai/"
      model: "gemini-3-flash-preview"
      max_tokens: 4000
      temperature: 0.3
      rate_limit_rpm: 5
      batch_size: 5
      max_concurrent: 1
    
    openai:
      api_key: "${OPENAI_API_KEY}"
      base_url: "https://api.openai.com/v1"
      model: "gpt-4o-mini"
      max_tokens: 2000
      temperature: 0.3
      batch_size: 5
      max_concurrent: 3
    
    claude:
      api_key: "${ANTHROPIC_API_KEY}"
      base_url: "https://api.anthropic.com/v1"
      model: "claude-3-haiku-20240307"
      max_tokens: 2000
      temperature: 0.3
      rate_limit_rpm: 50
      batch_size: 5
      max_concurrent: 3
    
    deepseek:
      api_key: "${DEEPSEEK_API_KEY}"
      base_url: "https://api.deepseek.com/v1"
      model: "deepseek-chat"
      max_tokens: 2000
      temperature: 0.3
      rate_limit_rpm: 60
      batch_size: 5
      max_concurrent: 3
    
    zhipu:
      api_key: "${ZHIPU_API_KEY}"
      base_url: "https://open.bigmodel.cn/api/paas/v4"
      model: "glm-4-flash"
      max_tokens: 65536      # 大模型支持长上下文，适合真批处理
      temperature: 0.3
      rate_limit_rpm: 50    # 降低每分钟请求数限制
      batch_size: 5         # 减小批次大小避免触发限制
      max_concurrent: 6     # 降低并发数以符合速率限制
    
    kimi:
      api_key: "${KIMI_API_KEY}"
      base_url: "https://api.moonshot.cn/v1"
      model: "moonshot-v1-8k"
      max_tokens: 2000
      temperature: 0.3
      rate_limit_rpm: 30
      batch_size: 5
      max_concurrent: 2
    
    qwen:
      api_key: "${DASHSCOPE_API_KEY}"
      base_url: "https://dashscope.aliyuncs.com/compatible-mode/v1"
      model: "qwen-max"
      max_tokens: 2000
      temperature: 0.3
      rate_limit_rpm: 60
      batch_size: 5
      max_concurrent: 3
    
    minimax:
      api_key: "${MINIMAX_API_KEY}"
      base_url: "https://api.minimax.chat/v1"
      model: "abab6.5-chat"
      max_tokens: 2000
      temperature: 0.3
      rate_limit_rpm: 60
      batch_size: 5
      max_concurrent: 3


  fallback:
    enabled: true
    max_retries_per_provider: 2
    fallback_chain:
      - "gemini"
      - "deepseek"
    
# ==========================================
# 全局评分标准（所有提供商共享）
# ==========================================
  scoring_criteria:
    importance: 0.30      # 重要性
    timeliness: 0.20      # 时效性
    technical_depth: 0.20 # 技术深度
    audience_breadth: 0.15 # 受众广度
    practicality: 0.15    # 实用性

# ==========================================
# AI评分缓存配置
# ==========================================
  cache_ttl_hours: 24     # AI评分缓存有效期(小时)

# ==========================================
# 真批处理配置(大幅降低API成本)
# ==========================================
  use_true_batch: true    # 是否启用真批处理(一次API调用处理多条)
  true_batch_size: 20     # 真批处理每批数量(保持10条避免过短)

# ==========================================
# 并行批处理配置(性能优化：将串行改为并行)
# ==========================================
  use_parallel_batches: true         # 禁用并行批处理，避免触发速率限制
  max_parallel_batches: 4             # 降低并发批次
  use_streaming: true                 # 启用流式响应，边生成边解析(减少等待)

# ==========================================
# 流式JSON解析配置(解决JSON截断问题)
# ==========================================
  use_streaming_json_parser: true       # 【新增】启用流式JSON解析，边接收边解析，解决截断问题
  streaming_json_priority: true        # 【新增】优先使用流式JSON解析（失败时自动降级到传统方式）
  streaming_json_buffer_size: 4096      # 【新增】流式解析缓冲区大小（字节）
  streaming_json_max_depth: 10          # 【新增】最大JSON嵌套深度

# ==========================================
# 超时控制配置(防止慢批次拖累整体)
# ==========================================
  batch_timeout_seconds: 120          # 批次超时时间(秒)
  timeout_fallback_strategy: "single" # 超时降级策略: single(单条处理)|default_score(默认分)

# ==========================================
# 2-Pass评分配置(提升重磅新闻识别率)
# ==========================================
  use_2pass: true         # 启用2-Pass评分(快速预筛+深度分析)
  
  # Pass 1 差异化阈值配置（你的选择：差异化门槛 B）
  pass1_threshold: 5.5    # 默认阈值（用于未分类新闻）
  pass1_threshold_finance: 5.5  # 财经新闻阈值（较宽松）
  pass1_threshold_tech: 6.0     # 科技新闻阈值（较严格）
  pass1_threshold_politics: 5.5 # 社会政治新闻阈值（较宽松）
  pass1_max_items: 80     # 预筛最大保留数量（增加，宽松Pass1）
  
  # 启用按板块差异化评分
  pass1_use_category_specific: true  # 启用三大板块差异化评分
  
  # 板块配额配置（固定比例 40%:30%:30%）
  category_quota_finance: 0.40  # 财经配额 40%
  category_quota_tech: 0.30     # 科技配额 30%
  category_quota_politics: 0.30 # 社会政治配额 30%

# ==========================================
# 语义去重配置(TF-IDF轻量级，GitHub Actions友好)
# ==========================================

# ==========================================
# 系统配置
# ==========================================
retry_attempts: 3
timeout: 120

# ==========================================
# 输出配置
# ==========================================
output:
  max_news_count: 30      # 每期精选新闻数量（增加到30条，12财经+9科技+9政治）
  max_feed_items: 50      # RSS feed 保留条数
  archive_days: 30        # 归档保留天数
  time_window_days: 1     # 只处理最近 N 天的新闻
  use_smart_switch: true # 是否启用智能切换（首次用archive，后续用latest）

# ==========================================
# 过滤配置
# ==========================================
filters:
  min_score_threshold: 0.0      # 最低评分阈值（设置为0，禁用最终过滤，改为排序竞争模式）
  # ⚠️ dedup_similarity 已弃用 - 我们已移除Levenshtein字符级去重
  # 改用纯语义去重（TF-IDF + 余弦相似度）
  # dedup_similarity: 0.85     # [已弃用] 标题Levenshtein相似度阈值
  
  # ✅ 语义去重（核心去重机制）
  use_semantic_dedup: true      # ✅ 启用TF-IDF语义去重(轻量级，~10MB内存)
  semantic_similarity: 0.85     # ✅ 语义相似度阈值(0-1)，0.85平衡准确率和召回率
  blocked_keywords:             # 屏蔽关键词列表
    - "广告"
    - "推广"
    - "促销"
